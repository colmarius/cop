<!DOCTYPE html>  <html> <head>   <title>cop.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               cop.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>Cop.js 0.1.1

(c) 2012 Marius Colacioiu
Cop library may be freely distributed under Apache 2.0 license.
For all details and documentation:
http://colmarius.github.com/cop/
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Initial Setup</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Save a reference to the global object (<code>window</code> in the browser, 
<code>global</code> on the server).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The top-level namespace. All public Cop classes and modules will
be attached to this. Exported for both CommonJS and the browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Cop</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
    <span class="nx">Cop</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">;</span> 
  <span class="k">else</span>
    <span class="nx">Cop</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Cop</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Current version of the library.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Cop</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.1.1&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Require Underscore, if we're on the server, and it's not already present.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">_</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">require</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">))</span> 
    <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Require Backbone, if we're on the server, and it's not already present.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Backbone</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">require</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">))</span>
    <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Require Traits, if we're on the server, and it's not already present.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Trait</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Trait</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Trait</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">require</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">))</span>
    <span class="nx">Trait</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;traits&#39;</span><span class="p">).</span><span class="nx">Trait</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Cop.Context</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>A <strong>Context</strong> object <em>reifies</em> the presence or absence of a <em>situation</em>
while an application executes. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Context</span> <span class="o">=</span> <span class="nx">Cop</span><span class="p">.</span><span class="nx">Context</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_configure</span><span class="p">(</span><span class="nx">options</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>All Context objects respond to Backbone.Events methods 
<code>on</code>, <code>off</code> and <code>trigger</code>. In particular, <code>on</code> and <code>off</code>
methods can be used to subscribe and unsubscribe <strong>callbacks</strong> 
on the <em>activate</em> and <em>deactivate</em> events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Context</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>The <code>initialize</code> method should provide logic to read some data
from the system and then invoke either the <code>activate</code> or 
<code>deactivate</code> methods on the context instance.
The ContextManager is created with a set of contexts and it 
uses the <code>initialize</code> method to perform context initialization.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Activating a Context is done by calling the <code>activate</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">activate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;activate&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Deactivating a Context is done by calling the <code>deactivate</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">deactivate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;deactivate&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>A context adaptation is declared by calling <code>adapt</code> on the Context, and 
by providing the <code>object</code> to be adapted and the adaptation as a <code>trait</code>.</p>

<p><em>Note</em>: <strong>Traits</strong> are <strong>composable units of code reuse</strong>. Here a single
trait is used as an adaptation: one which exhibits context-dependent 
behavior for a single object. A trait is used to group a set of methods 
and properties that can be acquired by an adapted object, at runtime, 
when the context is active.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">adapt</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">trait</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">root</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot adapt the global object.&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">object</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Only objects can be adapted.&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getAdaptation</span><span class="p">(</span><span class="nx">object</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Object already adapted.&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">adaptations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">object</span><span class="o">:</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">trait</span><span class="o">:</span> <span class="nx">trait</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;adapt&quot;</span><span class="p">,</span> <span class="nx">object</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Returns the <em>adaptation</em> for the <code>object</code> if one was previously stored.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getAdaptation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adapted</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">adapted</span><span class="p">.</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">object</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Performs the initial configuration of a Context from a set of 
<code>options</code>. All contexts must have a <em>name</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_configure</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>      
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Context object must have a name.&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">active</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">adaptations</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">name</span>        <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">initialize</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">initialize</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Cop.ContextManager</h2>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>There should be <em>just one</em> ContextManager in the hole system. 
Upon creation should be provided with all known Context objects
and all possible relations.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">ContextManager</span> <span class="o">=</span> <span class="nx">Cop</span><span class="p">.</span><span class="nx">ContextManager</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_configure</span><span class="p">(</span><span class="nx">options</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Set up all intheritable <strong>ContextManager</strong> properties and methods.</p>

<p>The ContextManager responds to <code>on</code>, <code>off</code> and <code>trigger</code> methods
inherited from Backbone.Events. Their purpose is for internal use,
to trigger the <em>start</em> and <em>end</em> of contexts recomposition.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">ContextManager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Performs ContextManager initialization. </p>

<p><em>Note</em>: Once started, the ContextManager is notified when a Context 
is <em>activated</em>, <em>deactivated</em> or <em>adapts</em> an object. In reaction to 
a Context activation / deactivation the ContextManager recomposes 
dynamically the behavior of adapted objects by making them acquire 
traits at runtime.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context manager is preparing to start up.&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">registered</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Initializing context &#39;&quot;</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&#39;.&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Store original behavior for objects that already have adaptations.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">adaptations</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">_onAdapt</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
          <span class="p">});</span> 
        <span class="p">}</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
        <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context &#39;&quot;</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&#39; is now initialized.&quot;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context manager is now running.&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;recompose:start&quot;</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context manager has started up.&quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>The <code>resolveConflict</code> method is used to solve a possible conflict that 
can happen at runtime between two or more traits for an adapted object. 
The <code>object</code> is the adapted object that has traits in conflict for the
contexts in the <code>contexts</code> array. <code>callback</code> is optional, and receives
the conflicting traits as parameters in the same order as in the 
<code>contexts</code> array and is expected to return a resolved conflict-free trait
when invoked.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">resolveConflict</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">,</span> <span class="nx">getResolvedTrait</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolvedTraits</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">records</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">resolvedTraits</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">records</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">records</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">object</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Object already has resolved trait for contexts: &quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">);</span>
      <span class="k">else</span>
        <span class="nx">records</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">object</span><span class="o">:</span>   <span class="nx">object</span><span class="p">,</span>
          <span class="nx">contexts</span><span class="o">:</span> <span class="nx">contexts</span><span class="p">,</span>
          <span class="nx">getResolvedTrait</span><span class="o">:</span> <span class="nx">getResolvedTrait</span>
        <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Called each time a Context <em>adapts</em> an object. Stores a clone for the 
basic behavior of the object the first time it gets adapted. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_onAdapt</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">originalObject</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">originalObjects</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">object</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">originalObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">originalObjects</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">object</span><span class="o">:</span>   <span class="nx">object</span><span class="p">,</span>
          <span class="nx">original</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Called each time a Context is <em>activated</em> or <em>deactivated</em>. If the 
ContextManager has already started it triggers a contexts recomposition
event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_onContextChange</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context &#39;&quot;</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&#39; triggered &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">active</span> <span class="o">?</span> <span class="s2">&quot;activate, marked for activation.&quot;</span> <span class="o">:</span> <span class="s2">&quot;deactivate, marked for deactivation.&quot;</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
      <span class="p">}</span> 
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toDeactivate</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;recompose:start&quot;</span><span class="p">);</span>
      <span class="k">else</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context manager not running: context &#39;&quot;</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&#39; not activated yet.&quot;</span><span class="p">);</span>
    <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Called before contexts recomposition. Delegates to Composer the task of 
recomposition of the current <em>active</em>, <em>toActivate</em> and <em>toDeactivate</em>
contexts.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_onRecomposeStart</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">contexts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">;</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Contexts recomposition started:&quot;</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Contexts active: [&quot;</span> <span class="o">+</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;], to activate: [&quot;</span> <span class="o">+</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;], to deactivate: [&quot;</span> <span class="o">+</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toDeactivate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;].&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">composer</span><span class="p">.</span><span class="nx">recompose</span><span class="p">({</span>
        <span class="nx">contexts</span><span class="o">:</span>  <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span>
        <span class="nx">relations</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">relations</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Called after contexts recomposition has ended. Composer has finished 
recomposing contexts and sets the new <em>active</em> contexts on the 
ContextManager.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_onRecomposeEnd</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contexts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">;</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Contexts recompositon ended!&quot;</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Contexts active: [&quot;</span> <span class="o">+</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;], to activate: [&quot;</span> <span class="o">+</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;], to deactivate: [&quot;</span> <span class="o">+</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toDeactivate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;].&quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Performs a first initialization of the ContextManager from a set of 
options. First initialize the <em>composer</em>, <em>contexts</em> and <em>relations</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_configure</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">composer</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Composer</span><span class="p">({</span> <span class="nx">contextManager</span><span class="o">:</span> <span class="k">this</span> <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">contexts</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Dictionary</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">relations</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dictionary</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Initialize contexts.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot create context manager without contexts.&quot;</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">name</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Already registered context: &quot;</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Register each Context object.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">contexts</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Subscribe the ContextManager to each Context's <em>activate</em>, 
<em>deactivate</em> and <em>adapt</em> event.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;activate&quot;</span><span class="p">,</span>   <span class="nx">self</span><span class="p">.</span><span class="nx">_onContextChange</span><span class="p">,</span> <span class="nx">self</span><span class="p">);</span>
          <span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;deactivate&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_onContextChange</span><span class="p">,</span> <span class="nx">self</span><span class="p">);</span>
          <span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;adapt&quot;</span><span class="p">,</span>      <span class="nx">self</span><span class="p">.</span><span class="nx">_onAdapt</span><span class="p">,</span>         <span class="nx">self</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p><strong>TODO</strong>: Initialize relations.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">relations</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">relations</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;TODO: initialize context relations.&quot;</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Subscribe to own <em>recompose:start</em> and <em>recompose:end</em> events,
triggered internally at context recomposition time.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;recompose:start&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onRecomposeStart</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;recompose:end&quot;</span><span class="p">,</span>   <span class="k">this</span><span class="p">.</span><span class="nx">_onRecomposeEnd</span><span class="p">,</span>   <span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Set instance attributes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">composer</span> <span class="o">=</span> <span class="nx">composer</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">registered</span><span class="o">:</span>   <span class="nx">contexts</span><span class="p">,</span>
        <span class="nx">active</span><span class="o">:</span>       <span class="p">[],</span>
        <span class="nx">toActivate</span><span class="o">:</span>   <span class="p">[],</span>
        <span class="nx">toDeactivate</span><span class="o">:</span> <span class="p">[]</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">originalObjects</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">relations</span> <span class="o">=</span> <span class="nx">relations</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">resolvedTraits</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dictionary</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h2>Composer</h2>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The ContextManager delegates to Composer the task of context 
recomposition at runtime. The Composer:</p>

<ul>
<li>knows how to gather and combine adaptations affected by the 
currently active contexts</li>
<li>make's use of the <code>Trait</code> library to compose traits</li>
<li>knows how to modify objects and how to make them acquire traits</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Composer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_configure</span><span class="p">(</span><span class="nx">options</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>An adaptation can access an object's original methods and properties 
using the following keyword.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">superName</span> <span class="o">=</span> <span class="s1">&#39;_super&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Set up all intheritable <strong>Composer</strong> properties and methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Composer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>This is the only <em>public method</em> of the Composer. The task is to 
compose the contexts passed in <code>options.contexts</code>. But first, 
possible dependencies between contexts are resolved by inspecting 
<code>options.relations</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">recompose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">adaptations</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">conflicts</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">contexts</span>  <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">relations</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">relations</span><span class="p">;</span>
      <span class="nx">contexts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resolveDependencies</span><span class="p">(</span><span class="nx">contexts</span><span class="p">,</span> <span class="nx">relations</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Contexts with resolved dependencies: &quot;</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">);</span>
      <span class="nx">adaptations</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getAdaptations</span><span class="p">(</span><span class="nx">contexts</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Uncomposed adaptations: &quot;</span><span class="p">,</span> <span class="nx">adaptations</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_compose</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Composed adaptations: &quot;</span><span class="p">,</span> <span class="nx">adaptations</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Filter conflicting adaptations.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">conflicts</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">hasConflict</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">conflicts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Log unresolved conflicts and throw conflict errors.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">conflicts</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">conflict</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">contexts</span>     <span class="o">=</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">conflict</span><span class="p">.</span><span class="nx">contexts</span><span class="p">);</span>
          <span class="kd">var</span> <span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">conflict</span><span class="p">.</span><span class="nx">errorMessage</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">object</span>       <span class="o">=</span> <span class="nx">conflict</span><span class="p">.</span><span class="nx">object</span><span class="p">;</span>
          <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Contexts &quot;</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">,</span> <span class="s2">&quot;, object: &quot;</span><span class="p">,</span> <span class="nx">object</span><span class="p">,</span> <span class="s2">&quot;, conflict: &quot;</span><span class="p">,</span> <span class="nx">errorMessage</span><span class="p">);</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Contexts &quot;</span> <span class="o">+</span> <span class="nx">contexts</span> <span class="o">+</span> <span class="s2">&quot; have unresolved conflict for object: &quot;</span> <span class="o">+</span> <span class="nx">object</span> <span class="o">+</span> <span class="s2">&quot; with error message: &quot;</span> <span class="o">+</span> <span class="nx">errorMessage</span><span class="p">);</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Restore contexts as before recomposition.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">contexts</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>          
        <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;No conflicts detected.&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>If there are no conflicts install adaptations.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">_install</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Compute new contexts.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">contexts</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">active</span>       <span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">union</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">),</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">toDeactivate</span><span class="p">),</span>
          <span class="nx">toActivate</span>   <span class="o">:</span> <span class="p">[],</span>
          <span class="nx">toDeactivate</span> <span class="o">:</span> <span class="p">[]</span>
        <span class="p">};</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Signal that context recomposition has finished and pass <em>new</em> 
<code>contexts</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">contextManager</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;recompose:end&quot;</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><strong>TODO</strong>: How relations impact on contexts (de) activation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_resolveDependencies</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contexts</span><span class="p">,</span> <span class="nx">relations</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;TODO: resolve context dependencies.&quot;</span><span class="p">);</span>
      <span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span>     <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">toDeactivate</span><span class="p">);</span>
      <span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">contexts</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Return <strong>all adaptations</strong> that need to be composed by looking in the 
contexts that are <em>active</em>, <em>to activate</em>, or <em>to deactivate</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_getAdaptations</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contexts</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Add to <code>results</code> a record with the <em>adapted object</em>. If <code>addTraits</code>
flag is set, add also the <em>context</em> and <em>trait</em>. </p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">addToResults</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">,</span> <span class="nx">addTraits</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">addTraits</span> <span class="o">||</span> <span class="p">(</span><span class="nx">addTraits</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">found</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Check if <em>adaptated object</em> is already present in <code>results</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">found</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">addTraits</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Add <em>trait</em> and <em>context</em> only if <code>addTraits</code> is set.</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">result</span><span class="p">.</span><span class="nx">traits</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">trait</span><span class="p">);</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">found</span> <span class="o">&amp;&amp;</span> <span class="nx">addTraits</span><span class="p">)</span> </pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>If not found and <code>addTraits</code> is set, 
add <em>adapted object</em> with <em>trait</em> and <em>context</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">object</span><span class="o">:</span>   <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span>
            <span class="nx">traits</span><span class="o">:</span>   <span class="p">[</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">trait</span><span class="p">],</span>
            <span class="nx">contexts</span><span class="o">:</span> <span class="p">[</span><span class="nx">context</span><span class="p">]</span>
          <span class="p">});</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">found</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Otherwise, add only <em>adapted object</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">object</span><span class="o">:</span>   <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span>
            <span class="nx">traits</span><span class="o">:</span>   <span class="p">[],</span>
            <span class="nx">contexts</span><span class="o">:</span> <span class="p">[]</span>
          <span class="p">});</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>For each <code>adaptation</code> in <code>contexts.toActivate</code> add to <code>results</code> 
a record with <em>adapted object</em>, <em>context</em> and <em>trait</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toActivate</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">addToResults</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>For each <code>adaptation</code> in <code>contexts.toDeactivate</code> add to <code>results</code> 
a record with only the <em>adapted object</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">toDeactivate</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">addToResults</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Store reference to original objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">originalObjects</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">contextManager</span><span class="p">.</span><span class="nx">originalObjects</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>For each <code>record</code> in <code>results</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>First, add <em>trait</em> and <em>context</em> from <code>active.contexts</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">active</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">activeContext</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">adaptation</span> <span class="o">=</span> <span class="nx">activeContext</span><span class="p">.</span><span class="nx">getAdaptation</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">record</span><span class="p">.</span><span class="nx">traits</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">trait</span><span class="p">);</span>
            <span class="nx">record</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">activeContext</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Then, add a clone of the <em>original object</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">originalObject</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">originalObjects</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">record</span><span class="p">.</span><span class="nx">object</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">record</span><span class="p">.</span><span class="nx">originalObject</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">originalObject</span><span class="p">.</span><span class="nx">original</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Compose all adaptations.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_compose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Store reference to ContextManager's <code>resolvedTraits</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">resolvedTraits</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">contextManager</span><span class="p">.</span><span class="nx">resolvedTraits</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Bind <code>this</code> reference in all methods in <code>object</code> on <code>self</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">bindAllMethods</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span>
            <span class="nx">object</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">self</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Mark adaptation if has conflicts, meaning some required property 
was not provided, or there are properties that are in conflict.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">checkConflicts</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">Trait</span><span class="p">.</span><span class="nx">create</span><span class="p">({},</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedTrait</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">adaptation</span><span class="p">.</span><span class="nx">hasConflict</span>  <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">adaptation</span><span class="p">.</span><span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Resolve conflict for adaptation by looking for a resolved trait
for the conflicting contexts.</p>

<p><strong>TODO</strong>: get <em>minimal conflicts</em> for the conflicting contexts 
(look only for those contexts in the adaptation).</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span>    <span class="o">=</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">resolvedTraits</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">record</span>  <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">records</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p><em>Order traits</em> in same order as the contexts found in the 
resolved trait <code>record</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">orderedTraits</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
            <span class="nx">orderedTraits</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">traits</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
          <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p><strong>Strategy 1</strong>: Do we have the <code>getResolvedTrait</code> callback?</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">getResolvedTrait</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Call <code>getResolvedTrait</code> callback to obtain the conflict-free 
trait.</p>

<p><strong>TODO</strong>: Check if <code>resolvedTrait</code> is <em>really conflict free</em>! 
At least it should be.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">resolvedTrait</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">getResolvedTrait</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">orderedTraits</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Set resolved trait on adaptation.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedTrait</span> <span class="o">=</span> <span class="nx">resolvedTrait</span><span class="p">;</span>
          <span class="p">}</span> </pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p><strong>Strategy 2</strong>: No callback provided, so apply traits like mixins. </p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Get object's <em>basic behavior</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">superObject</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">originalObject</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">composedObject</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Bind <code>this</code> in <code>superObject</code> to the <em>original</em> object reference 
of the adapted object.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">bindAllMethods</span><span class="p">(</span><span class="nx">superObject</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Extend basic behavior with traits applied on object 
from right to left order.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">orderedTraits</span><span class="p">.</span><span class="nx">reverse</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">trait</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="p">{};</span>
              <span class="nx">_super</span><span class="p">[</span><span class="nx">superName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">superObject</span><span class="p">;</span>
              <span class="nx">composedObject</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">superObject</span><span class="p">,</span> <span class="nx">Trait</span><span class="p">.</span><span class="nx">compose</span><span class="p">(</span><span class="nx">trait</span><span class="p">,</span> <span class="nx">Trait</span><span class="p">(</span><span class="nx">_super</span><span class="p">)));</span>
              <span class="nx">superObject</span> <span class="o">=</span> <span class="nx">composedObject</span><span class="p">;</span>
            <span class="p">});</span>
            <span class="k">delete</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedTrait</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>This <code>composedObject</code> has the behavior of the <em>adapted object</em> 
for the current set of <em>active contexts</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedObject</span> <span class="o">=</span> <span class="nx">composedObject</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">delete</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">hasConflict</span><span class="p">;</span>
          <span class="k">delete</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">errorMessage</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>For each <code>adaptation</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Compose the adaptation's <code>traits</code> into a <code>composedTrait</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedTrait</span> <span class="o">=</span> <span class="nx">Trait</span><span class="p">.</span><span class="nx">compose</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">traits</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Check adaptation for <em>conflicts</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">checkConflicts</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Try to <em>resolve</em> the conflict if any.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">hasConflict</span><span class="p">)</span> 
          <span class="nx">resolve</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>If not resolved log the conflict, because a <code>resolvedTrait</code> 
record is <em>missing</em> and should have been provided.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">hasConflict</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;No resolved trait provided for object: &quot;</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="s2">&quot; and contexts: &quot;</span><span class="p">,</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">contexts</span><span class="p">));</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Is there a <code>composedTrait</code> present? 
If not, there is already a <code>composedObject</code> present.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedTrait</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="p">{};</span>
          <span class="kd">var</span> <span class="nx">superObject</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">originalObject</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Bind <code>this</code> in the <code>superObject</code> to <em>original</em> object reference 
for the adapted object.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">bindAllMethods</span><span class="p">(</span><span class="nx">superObject</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
          <span class="nx">_super</span><span class="p">[</span><span class="nx">superName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">superObject</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Recompose trait with reference to the <em>original object</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">composedTrait</span> <span class="o">=</span> <span class="nx">Trait</span><span class="p">.</span><span class="nx">compose</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedTrait</span><span class="p">,</span> <span class="nx">Trait</span><span class="p">(</span><span class="nx">_super</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Create composed object.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedObject</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">superObject</span><span class="p">,</span> <span class="nx">composedTrait</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>For each adaptation, restore <em>adapted object</em> from the <em>composed object</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_install</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">function</span> <span class="nx">restore</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">fromObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">object</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span> <span class="k">delete</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="p">});</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">fromObject</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">adaptations</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">restore</span><span class="p">(</span><span class="nx">adaptation</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="nx">adaptation</span><span class="p">.</span><span class="nx">composedObject</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>First initialization of the Composer.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_configure</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">contextManager</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot create composer without a context manager.&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">contextManager</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contextManager</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <h2>Dictionary</h2>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Simple dictionary for storing name-value pairs, for internal use only.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Dictionary</span><span class="p">(</span><span class="nx">startValues</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">startValues</span><span class="p">)</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Set up all intheritable <strong>Dictionary</strong> properties and methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Dictionary</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Store <code>name</code> and <code>value</code> pair.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">store</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Lookup value for <code>name</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">lookup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Check if <code>name</code> was already stored in dictionary.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">contains</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Invoke the <code>action</code> function on each dictionary name-value pair.    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">each</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <h2>Helpers</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Returns a string composed from the names of the <code>contexts</code>. 
Optionally ordered, if <code>ordered</code> flag is set.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">contexts</span><span class="p">,</span> <span class="nx">ordered</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">contexts</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ordered</span><span class="p">)</span> <span class="nx">result</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Keep history for sanity reasons.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">ContextManager</span><span class="p">.</span><span class="nx">history</span> <span class="o">=</span> <span class="p">[];</span> </pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Logged messages go into history.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>You can inspect the history of logged messages in the console by calling:</p>

<pre><code>Cop.ContextManager.showHistory();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ContextManager</span><span class="p">.</span><span class="nx">showHistory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">history</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lineArray</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">lineArray</span><span class="p">);</span> 
    <span class="p">});</span>
  <span class="p">};</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 